"""
NAU AI Assistant Backend - Configuration
Конфигурация приложения
"""

import os
from typing import List
from dotenv import load_dotenv
load_dotenv()

class Settings:
    """Налаштування програми"""
    
    # Основні налаштування сервера
    HOST: str = os.getenv("HOST", "localhost")
    PORT: int = int(os.getenv("PORT", 8001))
    DEBUG: bool = os.getenv("DEBUG", "false").lower() == "true"
    ENVIRONMENT: str = os.getenv("ENVIRONMENT", "development")
    MAX_CONTEXT_TOKENS: int = int(os.getenv("MAX_CONTEXT_TOKENS", 6000))
    # CORS настройки
    ALLOWED_ORIGINS: List[str] = [
        "http://localhost:3000",  # React dev server
        "http://localhost:5173",  # Vite dev server
        "http://127.0.0.1:3000",
        "http://127.0.0.1:5173",
        # У продакшені додати домен фронтенду
    ]
    GEMINI_API_KEY: str = os.getenv("GEMINI_API_KEY", "")
    GEMINI_MODEL: str = os.getenv("GEMINI_MODEL", "gemini-2.0-flash")
    USE_GEMINI: bool = os.getenv("USE_GEMINI", "false").lower() == "true"
    
    # Шляхи до даних
    VECTOR_DB_PATH: str = os.getenv("VECTOR_DB_PATH", "./nau_vector_db")
    NEWS_DATA_PATH: str = os.getenv("NEWS_DATA_PATH", "./naunews")
    
    # LM Studio налаштування
    LM_STUDIO_URL: str = os.getenv("LM_STUDIO_URL", "http://localhost:1234/v1/chat/completions")
    LM_STUDIO_TIMEOUT: int = int(os.getenv("LM_STUDIO_TIMEOUT", 300))
    
    # Налаштування генерації
    GENERATION_TEMPERATURE: float = float(os.getenv("GENERATION_TEMPERATURE", 0.3))
    MAX_TOKENS: int = int(os.getenv("MAX_TOKENS", 1000))
    MAX_HISTORY_MESSAGES: int = int(os.getenv("MAX_HISTORY_MESSAGES", 6))
    
    # Налаштування пошуку в базі даних
    SEARCH_TOP_K: int = int(os.getenv("SEARCH_TOP_K", 3))
    RECENT_NEWS_DAYS: int = int(os.getenv("RECENT_NEWS_DAYS", 30))
    
    # Налаштування розкладу
    SCHEDULE_CACHE_ENABLED: bool = os.getenv("SCHEDULE_CACHE_ENABLED", "true").lower() == "true"
    SCHEDULE_REQUEST_TIMEOUT: int = int(os.getenv("SCHEDULE_REQUEST_TIMEOUT", 10))
    
    # Портал КАІ
    NAU_PORTAL_BASE_URL: str = os.getenv("NAU_PORTAL_BASE_URL", "https://portal.nau.edu.ua")
    NAU_GROUPS_LIST_URL: str = f"{NAU_PORTAL_BASE_URL}/schedule/group/list"
    
    # Логування
    LOG_LEVEL: str = os.getenv("LOG_LEVEL", "INFO")
    LOG_SYSTEM_PROMPTS: bool = os.getenv("LOG_SYSTEM_PROMPTS", "true").lower() == "true"
    
    # Безпека
    RATE_LIMIT_REQUESTS: int = int(os.getenv("RATE_LIMIT_REQUESTS", 100))
    RATE_LIMIT_PERIOD: int = int(os.getenv("RATE_LIMIT_PERIOD", 60))  # секунды
    
    # Векторна база даних
    SEARCH_SIMILARITY_THRESHOLD: float = float(os.getenv("SEARCH_SIMILARITY_THRESHOLD", 0.3))
    ENABLE_QUERY_EXPANSION: bool = os.getenv("ENABLE_QUERY_EXPANSION", "true").lower() == "true"
    BATCH_SIZE: int = int(os.getenv("BATCH_SIZE", 100))
    
    # Часи занять КАІ
    TIME_SLOTS = [
        ("1", "08:00", "09:35"),
        ("2", "09:50", "11:25"),
        ("3", "11:40", "13:15"),
        ("4", "13:30", "15:05"),
        ("5", "15:20", "16:55"),
        ("6", "17:10", "18:45"),
        ("7", "19:00", "20:35")
    ]
    
    # Дні тижня
    WEEKDAYS = ["Понеділок", "Вівторок", "Середа", "Четвер", "П'ятниця", "Субота", "Неділя"]
    
    # Початок семестру (для розрахунку тижнів)
    SEMESTER_START_DATE: str = os.getenv("SEMESTER_START_DATE", "2025-09-01")
    
    def get_debug_info(self) -> dict:
        """Отримати інформацію про налаштування"""
        return {
            "environment": self.ENVIRONMENT,
            "debug": self.DEBUG,
            "host": self.HOST,
            "port": self.PORT,
            "vector_db_path": self.VECTOR_DB_PATH,
            "lm_studio_url": self.LM_STUDIO_URL,
            "model": self.DEFAULT_MODEL,
            "allowed_origins": self.ALLOWED_ORIGINS,
            "log_level": self.LOG_LEVEL
        }
    
    def validate_paths(self) -> dict:
        """Перевірити існування шляхів"""
        results = {}
        
        # Перевіряємо директорію новин
        results["news_data"] = os.path.exists(self.NEWS_DATA_PATH)
        
        # Перевіряємо/створюємо директорію для векторної БД
        if not os.path.exists(self.VECTOR_DB_PATH):
            os.makedirs(self.VECTOR_DB_PATH, exist_ok=True)
        results["vector_db"] = True
        
        return results


settings = Settings()


CATEGORIES_MAPPING = {
    "education": [
        "факультет", "кафедра", "спеціальність", "освітн", "навчан", "студент", 
        "магістр", "бакалавр", "курс", "лекці", "семінар", "практичн", "заняття",
        "викладач", "професор", "доцент", "педагог", "методик", "дисциплін",
        "навчальний процес", "освітня програм", "силабус", "робоч програм",
        "компетентност", "результат навчання", "оцінюван", "екзамен", "залік"
    ],
    
    "admission": [
        "вступ", "приймальн", "абітурієнт", "документи", "заява", "конкурс", 
        "зарахуван", "вступн іспит", "конкурсн бал", "рейтинг", "зно", "нмт",
        "єві", "зв", "сертифікат", "атестат", "оригінал документів",
        "день відкритих дверей", "профорієнтаці", "приймальн комісі",
        "вступн кампані", "списк зарахованих", "подач документів"
    ],
    
    "finance": [
        "вартість", "плата", "оплат", "гроші", "стипенді", "банківськ", "реквізит",
        "контракт", "бюджет", "фінанс", "кошт", "матеріальн допомог",
        "академічн стипендія", "соціальн стипендія", "іменн стипендія",
        "оплата навчання", "плата за гуртожиток", "знижк", "пільг",
        "грант", "фінансуван", "спонсорств", "благодійн внеск"
    ],
    
    "contacts": [
        "контакт", "телефон", "адрес", "email", "зв'язатися", "приймальні години",
        "пошт", "сайт", "соціальн мереж", "facebook", "instagram", "telegram",
        "місцезнаходження", "як дістатися", "де знаходиться", "проїзд",
        "графік роботи", "робочий час", "вихідн", "цілодобов"
    ],
    
    "science": [
        "наук", "дослідж", "публікац", "конференц", "симпозіум", "дисертац", 
        "аспірант", "докторант", "науков робот", "науково-дослідн",
        "експеримент", "лабораторі", "науков школ", "монографі", "стаття",
        "scopus", "web of science", "індекс цитуван", "h-index", "імпакт-фактор",
        "наукові проєкт", "грант", "фінансуван дослідж", "патент", "ноу-хау",
        "інтелектуальн власність", "науков ступінь", "вчен звання"
    ],
    
    "international": [
        "міжнародн", "партнер", "співпрац", "обмін", "стажуван", "erasmus",
        "horizon", "tempus", "євросоюз", "євроінтеграці", "fulbright", "daad",
        "академічн мобільність", "подвійн диплом", "спільн програм",
        "іноземн студент", "іноземн делегаці", "візит", "робоч візит",
        "міжнародн конференці", "міжнародн проєкт", "глобальн партнер",
        "транснаціональн", "міжуніверситетськ співпрац"
    ],
    
    "meetings": [
        "засідання", "рада", "збори", "нарада", "комісія", "ректорат",
        "вчена рад", "деканат", "кафедральн засідання", "педагогічн рад",
        "методичн рад", "наукова рад", "оперативн нарада", "ректор", "декан",
        "рішення", "призначення", "наказ", "керівництв", "адміністраці",
        "управлінськ рішення", "стратегі", "розвиток", "реформуван"
    ],
    
    "academic_defense": [
        "захист", "дисертац", "диплом", "атестац", "сесія", "іспит",
        "дипломн робот", "магістерськ робот", "бакалаврськ робот",
        "кваліфікаційн робот", "курсов робот", "державн екзамен",
        "публічн захист", "передзахист", "атестаційн комісі",
        "екзаменаційн комісі", "державн атестаці", "випускн іспит",
        "випуск", "випускник", "алюмн", "червоний диплом"
    ],
    
    "competitions": [
        "змаган", "конкурс", "олімпіад", "турнір", "перемог", "призер",
        "чемпіонат", "першість", "спартакіад", "кубок", "універсіад",
        "всеукраїнськ олімпіад", "міжнародн олімпіад", "студентськ олімпіад",
        "науков конкурс", "творч конкурс", "професійн конкурс",
        "спортивн змагання", "інтелектуальн змагання", "хакатон", "квіз",
        "переможц", "лауреат", "дипломант", "фіналіст", "медаліст", "гран-прі"
    ],
    
    "awards": [
        "нагород", "відзнак", "досягнен", "перемог", "перш місц",
        "друг місц", "трєт місц", "грамот", "подяк", "сертифікат",
        "диплом переможця", "визнання", "почесн звання", "премія",
        "стипендія за досягнення", "номінація", "спеціальн приз"
    ],
    
    "infrastructure": [
        "гуртожит", "бібліотек", "їдальн", "спортзал", "корпус", "аудитор",
        "кабінет", "лабораторі", "читальн зал", "медіатек", "буфет", "кафе",
        "тренажерн зал", "басейн", "стадіон", "паркінг", "парковк",
        "облаштуван", "ремонт", "реконструкці", "будівництв", "майданчик"
    ],
    
    "technology": [
        "комп'ютер", "програм", "it", "інформацій", "цифров", "технологі",
        "software", "hardware", "розробк", "програмуван", "кодуван",
        "штучний інтелект", "machine learning", "ai", "нейронн мереж",
        "big data", "data science", "blockchain", "iot", "cloud",
        "digitalізація", "цифрова трансформаці", "автоматизація", "кібербезпек"
    ],
    
    "innovation": [
        "інновац", "стартап", "бізнес-інкубатор", "технопарк", "інноваційн центр",
        "інноваційн проєкт", "технологічн розробк", "стартап-проєкт",
        "підприємництв", "бізнес-ідея", "комерціалізаці", "венчур",
        "акселератор", "менторств", "інвестиці", "індустрія 4.0"
    ],
    
    "student_life": [
        "студентськ життя", "студентськ активність", "студентськ організаці",
        "студентськ самоврядуван", "студрад", "студентськ клуб",
        "студентськ гурток", "студентськ спільнот", "студмістечк", "кампус",
        "позааудиторн діяльність", "дозвілля", "розваг", "відпочинок",
        "студентськ ініціатив", "молодіжн рух", "профком студентів"
    ],
    
    "sports": [
        "спорт", "фізичн культур", "здоров'я", "фітнес", "тренуван",
        "футбол", "волейбол", "баскетбол", "теніс", "плаван", "шахи",
        "легк атлетик", "єдиноборств", "бокс", "боротьб", "карате",
        "спортивн команд", "збірн", "спортивн секці", "спортивн клуб",
        "здоровий спосіб життя", "фізичн активність", "медичн огляд"
    ],
    
    "culture": [
        "культур", "мистецтв", "виставк", "концерт", "фестиваль",
        "творчість", "художн", "експозиці", "театр", "музик",
        "хор", "оркестр", "ансамбль", "танц", "хореографі", "балет",
        "літератур", "поезі", "живопис", "скульптур", "фотографі",
        "культурн захід", "творч вечір", "перформанс", "вернісаж"
    ],
    
    "conferences": [
        "конференц", "семінар", "симпозіум", "форум", "круглий стіл",
        "науков конференці", "міжнародн конференці", "всеукраїнськ конференці",
        "науково-практичн конференці", "воркшоп", "майстер-клас",
        "тренінг", "лекторій", "науков читання", "постерн сесі",
        "панельн дискусі", "науков дебат", "науков школ"
    ],
    
    "partnership": [
        "співпрац", "партнер", "договір", "угод", "меморандум",
        "партнерств", "угод про співпрацю", "меморандум про взаєморозуміння",
        "стратегічн партнер", "бізнес-партнер", "індустріальн партнер",
        "академічн партнер", "консорціум", "альянс", "мереж партнерів",
        "роботодавц", "базов підприємств", "дуальн освіт"
    ],
    
    "career": [
        "працевлаштуван", "кар'єр", "вакансі", "робоч місця", "практик",
        "стажуван", "виробнича практик", "навчальн практик",
        "ярмарок вакансій", "день кар'єр", "центр кар'єр",
        "кар'єрн консультуван", "професійн розвиток", "резюме", "cv",
        "співбесід", "роботодавц", "переддипломн практик"
    ],
    
    "social": [
        "соціальн", "волонтер", "благодійність", "допомог", "підтримк",
        "соціальн проєкт", "громадськ ініціатив", "волонтерськ діяльність",
        "благодійн акці", "гуманітарн допомог", "соціальн відповідальність",
        "інклюзі", "доступн середовищ", "адаптаці", "психологічн підтримк",
        "громадськ організаці", "нго", "соціальн служб"
    ],
    
    "ceremonies": [
        "урочист", "святкуван", "ювілей", "річниц", "свято",
        "день народження", "день університет", "день факультет",
        "урочист засідання", "урочист вручення", "посвят у студент",
        "випускний", "вручення дипломів", "день знань", "день науки",
        "святковий захід", "святкова програм", "церемонія"
    ],
    
    "publications": [
        "публікаці", "стаття", "монографі", "збірник", "журнал",
        "наукова публікаці", "наукова стаття", "фахов видання",
        "рецензован видання", "індексована публікаці", "наукометрі",
        "препринт", "постпринт", "відкритий доступ", "open access",
        "наукове видання", "рецензування", "редакційн колегі"
    ],
    
    "quality": [
        "якість", "акредитаці", "ліцензуван", "стандарт", "рейтинг",
        "забезпечення якості", "система якості", "внутрішн забезпечення",
        "зовнішн забезпечення", "національн агенці якості",
        "акредитаційн експертиз", "самооцінюван", "самоаналіз",
        "освітн стандарт", "професійн стандарт", "моніторинг якості",
        "задоволеність студентів", "опитуван", "анкетуван"
    ],
    
    "digitalization": [
        "цифровізаці", "digitalізація", "онлайн", "дистанційн",
        "електронн", "віртуальн", "платформ", "e-learning",
        "дистанційн навчання", "онлайн-курс", "відеолекці", "вебінар",
        "електронн бібліотек", "електронн ресурс", "цифров ресурс",
        "хмарн технологі", "цифров компетентност", "медіаграмотність",
        "електронн документообіг", "електронн підпис", "онлайн-сервіс"
    ],
    
    "aviation": [
        "авіац", "літак", "політ", "авіаційн", "аеронавігац",
        "пілотуван", "екіпаж", "аеропорт", "авіаперевезення",
        "авіакомпан", "цивільн авіаці", "авіабудуван", "авіадвигун",
        "безпек польотів", "повітрян простір", "диспетчеризаці"
    ],
    
    "space": [
        "космос", "космічн", "супутник", "ракет", "космонавтик",
        "орбіт", "космічн апарат", "космодром", "запуск супутник",
        "космічн дослідження", "астронавт", "космічн технологі"
    ],
    
    "general": [
        "інформаці", "повідомлен", "оголошення", "новин", "подій",
        "анонс", "увага", "важлив", "терміново", "актуальн",
        "оновлення", "зміни", "нагадуєм", "запрошуєм"
    ]
}

FACULTY_KEYWORDS = {
    "ФКНТ": [
        "фкнт", "фкит", "фкнит",
        "факультет комп'ютерних наук", "факультет компютерних наук",
        "комп'ютерних наук та технологій", "комп'ютерних наук і технологій",
        "комп'ютерних наук", "компютерних наук",
        "факультет компьютерных наук", "факультет информатики",
        "компьютерных наук и технологий", "компьютерных наук",
        "computer science faculty", "faculty of computer science", "cs faculty",
        "комп'ютерний факультет", "айтішний факультет", "ит факультет",
        "факультет айті", "факультет программистов", "факультет програмування",
        "іпз", "кіт", "ксм", "кззі", "ксзі", "ікс", "пм",
        "програмування", "програмного забезпечення", "кібербезпека"
    ],
    
    "ФАЕТ": [
        "фает", "фаєт",
        "факультет аеронавігації", "аеронавігації електроніки та телекомунікацій",
        "аеронавігації електроніки телекомунікацій",
        "аеронавігації", "електроніки", "телекомунікацій",
        "факультет аэронавигации", "аэронавигации электроники и телекоммуникаций",
        "аэронавигации", "электроники", "телекоммуникаций",
        "faculty of air navigation", "air navigation faculty",
        "electronics and telecommunications", "aeronavigation",
        "авіаційний факультет", "авиационный факультет",
        "факультет електроніки", "факультет связи", "факультет зв'язку",
        "радіофакультет", "радиофакультет",
        "ткс", "асу", "акік", "ерміт", "анс", "авіоніка", "радіо",
        "телекомунікації", "аеронавігаційні системи"
    ]
}

DEPARTMENT_KEYWORDS = {
    "ПМ": [
        "пм", "прикладна математика", "прикладной математики",
        "кафедра прикладної математики", "прикладная математика",
        "applied mathematics", "математики", "матан", "мат кафедра",
        "вища математика", "математичний аналіз", "диференційні рівняння"
    ],
    
    "ІПЗ": [
        "іпз", "ипз", "інженерії програмного забезпечення",
        "інженерія програмного забезпечення", "інженерія пз",
        "инженерии программного обеспечения", "инженерия по",
        "software engineering", "se department",
        "програмного забезпечення", "программного обеспечения",
        "софтверної інженерії", "програмування", "розробка по",
        "121", "121 спеціальність", "малярчук",
        "java", "python", "c++", "web розробка", "ооп"
    ],
    
    "КІТ": [
        "кіт", "кит", "комп'ютерних інформаційних технологій",
        "комп'ютерні інформаційні технології",
        "компьютерных информационных технологий",
        "computer information technologies", "cit department",
        "інформаційних технологій", "інформаційні технології",
        "айті кафедра", "126", "126 спеціальність",
        "інформаційні системи", "бази даних", "data science", "big data"
    ],
    
    "КСМ": [
        "ксм", "комп'ютерних систем та мереж",
        "комп'ютерні системи та мережі", "комп'ютерні системи і мережі",
        "компьютерных систем и сетей", "компьютерные системы и сети",
        "computer systems and networks", "csn department",
        "системи та мережі", "комп'ютерні мережі", "мережева кафедра",
        "123", "комп'ютерна інженерія", "мережі", "networks", "cisco",
        "адміністрування", "linux", "windows server"
    ],
    
    "КЗЗІ": [
        "кззі", "кзі", "ззі", "кззи", "тзі",
        "технічного захисту інформації", "технічний захист інформації",
        "захист інформації", "технической защиты информации",
        "technical information protection", "infosec department",
        "техзахист", "техзащита", "інформбезпека", "безпека інформації",
        "125", "кібербезпека та захист інформації", "технічний захист",
        "криптографія", "шифрування", "encryption", "спеціальні дослідження"
    ],
    
    "КСЗІ": [
        "ксзі", "кібербезпеки", "кибербезопасности",
        "кафедра кібербезпеки", "кібербезпека",
        "кибербезопасность", "cybersecurity", "cyber security",
        "кібер", "киберзащита", "кіберзахист", "cyber",
        "125", "кібербезпека 125", "хакінг", "пентест",
        "ethical hacking", "вразливості", "firewall"
    ],
    
    "ІКС": [
        "ікс", "икс", "інтелектуальних кібернетичних систем",
        "інтелектуальні кібернетичні системи",
        "интеллектуальных кибернетических систем",
        "intelligent cybernetic systems", "ics department",
        "кібернетичних систем", "кібернетика", "інтелектуальні системи",
        "ai кафедра", "штучний інтелект", "126",
        "ai", "machine learning", "deep learning", "нейронні мережі",
        "робототехніка", "комп'ютерний зір", "nlp"
    ],
    
    "ТКС": [
        "ткс", "телекомунікаційних та радіоелектронних систем",
        "телекомунікаційні та радіоелектронні системи",
        "телекоммуникационных и радиоэлектронных систем",
        "telecommunications and radio electronic systems", "telecom department",
        "телекомунікацій", "радіоелектроніки", "зв'язку", "радіо кафедра",
        "172", "телекомунікації та радіотехніка",
        "радіо", "зв'язок", "антени", "сигнали", "передавачі"
    ],
    
    "АСУ": [
        "асу", "авіоніки та систем управління",
        "авіоніка та системи управління", "авіоніка",
        "авионики и систем управления", "авионика",
        "avionics and control systems", "avionics department",
        "систем управління", "авіаційні системи", "літакові системи",
        "151", "автоматизація", "автопілот", "навігація",
        "управління польотом", "авіаційна електроніка"
    ],
    
    "АКІК": [
        "акік", "акик", "авіаційних комп'ютерно-інтегрованих комплексів",
        "авіаційні комп'ютерно-інтегровані комплекси",
        "авиационных компьютерно-интегрированных комплексов",
        "aviation computer-integrated systems",
        "комп'ютерно-інтегрованих комплексів",
        "авіаційні комп'ютери", "бортові комп'ютери",
        "152", "метрологія", "бортові системи", "вимірювальна техніка"
    ],
    
    "ЕРМІТ": [
        "ерміт", "єрміт", "ermit",
        "електроніки робототехніки", "електроніки робототехніки і технологій моніторингу",
        "електроніки робототехніки та інтернету речей",
        "electronics robotics and iot", "iot department",
        "електроніки", "робототехніки", "інтернет речей", "iot",
        "173", "авіоніка", "робототехника", "роботи",
        "arduino", "raspberry pi", "датчики", "умный дом"
    ],
    
    "АНС": [
        "анс", "аеронавігаційних систем", "аеронавігаційні системи",
        "аеронавігація", "аэронавигационных систем", "аэронавигация",
        "air navigation systems", "navigation systems",
        "навігаційних систем", "навігація", "авіаційна навігація",
        "172", "gps", "радіонавігація", "супутникова навігація",
        "маршрути польотів", "диспетчеризація"
    ]
}

DEPARTMENT_TO_FACULTY = {
    "ПМ": "ФКНТ", "ІПЗ": "ФКНТ", "КІТ": "ФКНТ", "КСМ": "ФКНТ",
    "КЗЗІ": "ФКНТ", "КСЗІ": "ФКНТ", "ІКС": "ФКНТ",
    "ТКС": "ФАЕТ", "АСУ": "ФАЕТ", "АКІК": "ФАЕТ", 
    "ЕРМІТ": "ФАЕТ", "АНС": "ФАЕТ"
}

SCHEDULE_KEYWORDS = [
    "розклад", "расписание", "пара", "заняття", "занятие",
    "понеділок", "вівторок", "середа", "четвер", "п'ятниця", "субота",
    "понедельник", "вторник", "среда", "четверг", "пятница", "суббота",
    "сегодня", "завтра", "сьогодні", "завтра", "некст", "наступн",
    "когда", "коли", "время", "час", "зараз", "сейчас",
    "какая пара", "яка пара", "урок", "лекция", "лекція"
]

GREETING_KEYWORDS = [
    "привіт", "привет", "здравствуй", "хай", "hi", "hello", "добрый день", "доброго дня"
]

NEWS_KEYWORDS = [
    "новин", "подій", "останн", "актуальн", "свіж", "що нового"
]